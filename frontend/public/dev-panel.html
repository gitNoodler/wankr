<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wankr Dev Panel</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: transparent; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; font-size: 13px; color: #ccc; }

    #dev-panel {
      position: fixed;
      top: 24px;
      left: 24px;
      width: 320px;
      min-width: 200px;
      min-height: 140px;
      max-width: 90vw;
      max-height: 90vh;
      background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
      border: 1px solid #333;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 2147483647;
    }

    #dev-panel-header {
      flex-shrink: 0;
      padding: 10px 12px;
      background: linear-gradient(180deg, #222 0%, #181818 100%);
      border-bottom: 1px solid #333;
      cursor: grab;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #dev-panel-header:active { cursor: grabbing; }
    #dev-panel-header h1 {
      font-size: 12px;
      font-weight: 600;
      color: #00ff41;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    #dev-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .btn {
      padding: 10px 14px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #252525;
      color: #ccc;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.15s, border-color 0.15s;
    }
    .btn:hover { background: #333; border-color: #555; }
    .btn-kill {
      background: linear-gradient(180deg, #3d1a1a 0%, #2a0f0f 100%);
      border-color: #8b2020;
      color: #ff6b6b;
      font-weight: 600;
    }
    .btn-kill:hover {
      background: linear-gradient(180deg, #4d2020 0%, #3a1515 100%);
      border-color: #b03030;
    }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    #resize-handle {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 16px;
      height: 16px;
      cursor: nwse-resize;
      background: linear-gradient(135deg, transparent 50%, #333 50%);
    }
    #resize-handle:hover { background: linear-gradient(135deg, transparent 50%, #00ff41 50%); }
    .status { font-size: 11px; color: #666; }
    .status.ok { color: #00ff41; }
    .status.err { color: #ff6b6b; }
  </style>
</head>
<body>
  <div id="dev-panel">
    <div id="dev-panel-header">
      <h1>Dev Panel</h1>
    </div>
    <div id="dev-panel-content">
      <section>
        <p style="margin-bottom: 8px; font-size: 11px; color: #888;">Grok conversation</p>
        <button id="btn-kill" class="btn btn-kill">ðŸ›‘ Emergency kill</button>
        <p id="kill-status" class="status" style="margin-top: 8px;"></p>
      </section>
    </div>
    <div id="resize-handle"></div>
  </div>

  <script>
    (function() {
      const API_BASE = '';
      const panel = document.getElementById('dev-panel');
      const header = document.getElementById('dev-panel-header');
      const resizeHandle = document.getElementById('resize-handle');
      const btnKill = document.getElementById('btn-kill');
      const killStatus = document.getElementById('kill-status');

      function api(url, opts = {}) {
        return fetch((API_BASE || '') + url, { ...opts, headers: { 'Content-Type': 'application/json', ...opts.headers } });
      }

      // --- Drag ---
      let dragStartX = 0, dragStartY = 0, panelStartX = 0, panelStartY = 0;
      header.addEventListener('mousedown', function(e) {
        if (e.target === resizeHandle) return;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        const rect = panel.getBoundingClientRect();
        panelStartX = rect.left;
        panelStartY = rect.top;
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', stopDrag);
      });
      function onDrag(e) {
        const dx = e.clientX - dragStartX;
        const dy = e.clientY - dragStartY;
        let x = panelStartX + dx;
        let y = panelStartY + dy;
        x = Math.max(0, Math.min(x, window.innerWidth - panel.offsetWidth));
        y = Math.max(0, Math.min(y, window.innerHeight - panel.offsetHeight));
        panel.style.left = x + 'px';
        panel.style.top = y + 'px';
      }
      function stopDrag() {
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
      }

      // --- Resize ---
      let resizeStartX = 0, resizeStartY = 0, startW = 0, startH = 0;
      resizeHandle.addEventListener('mousedown', function(e) {
        e.preventDefault();
        e.stopPropagation();
        resizeStartX = e.clientX;
        resizeStartY = e.clientY;
        startW = panel.offsetWidth;
        startH = panel.offsetHeight;
        document.addEventListener('mousemove', onResize);
        document.addEventListener('mouseup', stopResize);
      });
      function onResize(e) {
        const dx = e.clientX - resizeStartX;
        const dy = e.clientY - resizeStartY;
        let w = Math.max(200, Math.min(window.innerWidth - panel.offsetLeft, startW + dx));
        let h = Math.max(140, Math.min(window.innerHeight - panel.offsetTop, startH + dy));
        panel.style.width = w + 'px';
        panel.style.height = h + 'px';
      }
      function stopResize() {
        document.removeEventListener('mousemove', onResize);
        document.removeEventListener('mouseup', stopResize);
      }

      // --- Kill switch ---
      btnKill.addEventListener('click', async function() {
        btnKill.disabled = true;
        killStatus.textContent = 'Sendingâ€¦';
        killStatus.className = 'status';
        try {
          const res = await api('/api/grok/kill', { method: 'POST' });
          const data = await res.json().catch(() => ({}));
          if (res.ok) {
            killStatus.textContent = 'Stopped';
            killStatus.className = 'status ok';
          } else {
            killStatus.textContent = data.error || 'Failed';
            killStatus.className = 'status err';
          }
        } catch (e) {
          killStatus.textContent = 'Network error';
          killStatus.className = 'status err';
        }
        btnKill.disabled = false;
      });
    })();
  </script>
</body>
</html>
